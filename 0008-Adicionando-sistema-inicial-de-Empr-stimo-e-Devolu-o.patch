From b1b5d5d39d04984268910c805f89487f85fe8a9d Mon Sep 17 00:00:00 2001
From: Breno de Andrade Soares <brenoandrade@tecgraf.puc-rio.br>
Date: Mon, 24 Nov 2025 13:47:12 -0300
Subject: [PATCH 08/18] =?UTF-8?q?Adicionando=20sistema=20inicial=20de=20Em?=
 =?UTF-8?q?pr=C3=A9stimo=20e=20Devolu=C3=A7=C3=A3o?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .gitignore                                   |   3 +-
 app/routes/book_routes.py                    |   8 +-
 app/routes/user_routes.py                    |  60 ++++-
 app/static/css/style.css                     | 242 +++++++++++++++++++
 app/templates/{ => books}/book.html          |   0
 app/templates/{ => books}/create.html        |   0
 app/templates/{ => books}/edit.html          |   0
 app/templates/{ => books}/index.html         |   0
 app/templates/users/create.html              |  29 +++
 app/templates/users/edit.html                |  29 +++
 app/templates/users/index.html               |  42 ++++
 app/templates/users/user.html                |  36 +++
 infra/db/database.db                         | Bin 20480 -> 20480 bytes
 infra/repositories/loan_repository_sqlite.py |  84 +++++++
 repositories/loan_repository.py              |  24 ++
 schema.sql                                   |   8 +
 use_cases/borrow_book.py                     |  10 +
 use_cases/list_user_loans.py                 |   6 +
 use_cases/return_book.py                     |  10 +
 19 files changed, 574 insertions(+), 17 deletions(-)
 rename app/templates/{ => books}/book.html (100%)
 rename app/templates/{ => books}/create.html (100%)
 rename app/templates/{ => books}/edit.html (100%)
 rename app/templates/{ => books}/index.html (100%)
 create mode 100644 app/templates/users/create.html
 create mode 100644 app/templates/users/edit.html
 create mode 100644 app/templates/users/index.html
 create mode 100644 app/templates/users/user.html
 create mode 100644 infra/repositories/loan_repository_sqlite.py
 create mode 100644 repositories/loan_repository.py
 create mode 100644 use_cases/borrow_book.py
 create mode 100644 use_cases/list_user_loans.py
 create mode 100644 use_cases/return_book.py

diff --git a/.gitignore b/.gitignore
index 4ea05a1..d804dbe 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,2 +1,3 @@
 venv/
-__pycache__/
\ No newline at end of file
+__pycache__/
+.venv/
\ No newline at end of file
diff --git a/app/routes/book_routes.py b/app/routes/book_routes.py
index b4fa7a6..3ee7294 100644
--- a/app/routes/book_routes.py
+++ b/app/routes/book_routes.py
@@ -15,7 +15,7 @@ book_bp = Blueprint("books", __name__, url_prefix="/books")
 @book_bp.route("/", methods=["GET"])
 def home():
     books = list_books(book_repo)
-    return render_template("index.html", books=books)
+    return render_template("books/index.html", books=books)
 
 # ======================== Exibir livro ==========================
 @book_bp.route("/<int:book_id>", methods=["GET"])
@@ -24,7 +24,7 @@ def book(book_id):
     if book is None:
         flash("Livro não encontrado")
         return redirect(url_for("books.home"))
-    return render_template("book.html", book=book)
+    return render_template("books/book.html", book=book)
 
 # ======================== Criar livro ==========================
 @book_bp.route("/create", methods=["GET", "POST"])
@@ -41,7 +41,7 @@ def create():
             flash("Livro cadastrado com sucesso!")
             return redirect(url_for("books.home"))
 
-    return render_template("create.html")
+    return render_template("books/create.html")
 
 # ======================== Editar livro ==========================
 @book_bp.route("/<int:book_id>/edit", methods=["GET", "POST"])
@@ -63,7 +63,7 @@ def edit(book_id):
             flash("Livro atualizado com sucesso!")
             return redirect(url_for("books.home"))
 
-    return render_template("edit.html", book=book)
+    return render_template("books/edit.html", book=book)
 
 # ======================== Deletar livro ==========================
 @book_bp.route("/<int:book_id>/delete", methods=["POST"])
diff --git a/app/routes/user_routes.py b/app/routes/user_routes.py
index 2eb18e4..355a946 100644
--- a/app/routes/user_routes.py
+++ b/app/routes/user_routes.py
@@ -4,29 +4,40 @@ from use_cases.get_user import get_user
 from use_cases.create_user import create_user
 from use_cases.update_user import update_user
 from use_cases.delete_user import delete_user
+
+from use_cases.borrow_book import borrow_book as borrow_book_uc
+from use_cases.return_book import return_book as return_book_uc
+from use_cases.list_user_loans import list_books_for_user
+
 from infra.repositories.user_repository_sqlite import UserRepositorySQLite
+from infra.repositories.loan_repository_sqlite import LoanRepositorySQLite
 
-# Instanciando o repositório SQLite de usuários
 user_repo = UserRepositorySQLite()
+loan_repo = LoanRepositorySQLite()
 
 user_bp = Blueprint("users", __name__, url_prefix="/users")
 
-# ======================== Listar usuários ==========================
+
+# ====== Listar usuários ======
 @user_bp.route("/", methods=["GET"])
 def home():
     users = list_users(user_repo)
     return render_template("users/index.html", users=users)
 
-# ======================== Exibir usuário ==========================
+
+# ====== Detalhe do usuário + livros emprestados ======
 @user_bp.route("/<int:user_id>", methods=["GET"])
 def user(user_id):
-    user = get_user(user_repo, user_id)
-    if user is None:
+    u = get_user(user_repo, user_id)
+    if u is None:
         flash("Usuário não encontrado")
         return redirect(url_for("users.home"))
-    return render_template("users/user.html", user=user)
 
-# ======================== Criar usuário ==========================
+    borrowed_books = list_books_for_user(loan_repo, user_id)
+    return render_template("users/user.html", user=u, borrowed_books=borrowed_books)
+
+
+# ====== Criar usuário ======
 @user_bp.route("/create", methods=["GET", "POST"])
 def create():
     if request.method == "POST":
@@ -41,11 +52,12 @@ def create():
 
     return render_template("users/create.html")
 
-# ======================== Editar usuário ==========================
+
+# ====== Editar usuário ======
 @user_bp.route("/<int:user_id>/edit", methods=["GET", "POST"])
 def edit(user_id):
-    user = get_user(user_repo, user_id)
-    if user is None:
+    u = get_user(user_repo, user_id)
+    if u is None:
         flash("Usuário não encontrado")
         return redirect(url_for("users.home"))
 
@@ -59,11 +71,35 @@ def edit(user_id):
             flash("Usuário atualizado com sucesso!")
             return redirect(url_for("users.home"))
 
-    return render_template("users/edit.html", user=user)
+    return render_template("users/edit.html", user=u)
+
 
-# ======================== Deletar usuário ==========================
+# ====== Deletar usuário ======
 @user_bp.route("/<int:user_id>/delete", methods=["POST"])
 def delete(user_id):
     delete_user(user_repo, user_id)
     flash("Usuário deletado com sucesso!")
     return redirect(url_for("users.home"))
+
+
+# ====== Emprestar livro para usuário ======
+@user_bp.route("/<int:user_id>/loans", methods=["POST"])
+def loan_book(user_id):
+    book_id = int(request.form["book_id"])
+    try:
+        borrow_book_uc(user_repo, loan_repo, user_id, book_id)
+        flash("Livro emprestado com sucesso!")
+    except ValueError as e:
+        flash(str(e))
+    return redirect(url_for("users.user", user_id=user_id))
+
+
+# ====== Devolver livro ======
+@user_bp.route("/<int:user_id>/returns/<int:book_id>", methods=["POST"])
+def return_book_route(user_id, book_id):
+    try:
+        return_book_uc(user_repo, loan_repo, user_id, book_id)
+        flash("Livro devolvido com sucesso!")
+    except ValueError as e:
+        flash(str(e))
+    return redirect(url_for("users.user", user_id=user_id))
diff --git a/app/static/css/style.css b/app/static/css/style.css
index 42b6903..175b702 100644
--- a/app/static/css/style.css
+++ b/app/static/css/style.css
@@ -523,4 +523,246 @@ form {
   font-size: 0.8rem;
   border-radius: 5px;
   margin-top: 0.5rem;
+}
+
+/* Reset and base */
+* {
+  box-sizing: border-box;
+  margin: 0;
+  padding: 0;
+  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
+  color: #333;
+}
+
+body {
+  background: #f9fafb;
+  line-height: 1.6;
+  padding: 1rem;
+  min-height: 100vh;
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+}
+
+/* Container for pages */
+.container {
+  background: #fff;
+  border-radius: 8px;
+  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
+  padding: 1.5rem 2rem;
+  margin-bottom: 2rem;
+  width: 100%;
+  max-width: 600px;
+  transition: box-shadow 0.3s ease;
+}
+.container:hover {
+  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
+}
+
+/* Headers and titles */
+h1, h2 {
+  color: #2c3e50;
+  margin-bottom: 1rem;
+  font-weight: 900;
+}
+h1 {
+  font-size: 2.5rem;
+  text-align: center;
+}
+h2 {
+  font-size: 1.8rem;
+  border-bottom: 2px solid #2980b9;
+  padding-bottom: 0.3rem;
+}
+
+/* Lists */
+ul {
+  list-style-type: none;
+  padding-left: 0;
+}
+li {
+  margin-bottom: 1rem;
+  font-size: 1.1rem;
+  color: #34495e;
+}
+
+/* Links */
+a {
+  color: #2980b9;
+  text-decoration: none;
+  font-weight: 600;
+  transition: color 0.3s ease, background-color 0.3s ease;
+}
+a:hover, a:focus {
+  background-color: #2980b9;
+  color: #fff;
+  border-radius: 4px;
+  padding: 0.2rem 0.4rem;
+}
+
+/* Buttons */
+button, .btn-primary {
+  background: #2980b9;
+  color: #fff;
+  border: none;
+  padding: 0.6rem 1rem;
+  border-radius: 6px;
+  font-weight: 700;
+  text-transform: uppercase;
+  letter-spacing: 0.04em;
+  cursor: pointer;
+  transition: background-color 0.3s ease;
+  font-size: 1.05rem;
+}
+button:hover, button:focus,
+.btn-primary:hover, .btn-primary:focus {
+  background: #1f6391;
+  outline: none;
+}
+
+/* Forms */
+form {
+  background: #fff;
+  padding: 1.5rem 2rem;
+  border-radius: 8px;
+  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
+  max-width: 400px;
+  margin: 1rem auto 2rem auto;
+  display: flex;
+  flex-direction: column;
+  gap: 1rem;
+}
+.form-group {
+  display: flex;
+  flex-direction: column;
+  gap: 0.3rem;
+}
+label {
+  font-weight: 600;
+  color: #2c3e50;
+  font-size: 1rem;
+}
+input[type="text"],
+input[type="number"] {
+  padding: 0.5rem 0.75rem;
+  border: 1.8px solid #ddd;
+  border-radius: 5px;
+  font-size: 1rem;
+  transition: border-color 0.3s ease;
+}
+input[type="text"]:focus,
+input[type="number"]:focus {
+  border-color: #2980b9;
+  outline: none;
+  box-shadow: 0 0 5px #2980b9aa;
+}
+
+/* Inline forms/buttons (for return book buttons) */
+form.inline-form {
+  display: inline;
+}
+form.inline-form button {
+  all: unset;
+  background-color: #2980b9;
+  color: white;
+  padding: 0.25rem 0.6rem;
+  border-radius: 6px;
+  font-weight: 700;
+  font-size: 0.9rem;
+  cursor: pointer;
+  text-transform: uppercase;
+  letter-spacing: 0.04em;
+  transition: background-color 0.3s ease;
+}
+form.inline-form button:hover,
+form.inline-form button:focus {
+  background-color: #1f6391;
+  outline: none;
+}
+
+/* Badges */
+.badge {
+  display: inline-block;
+  padding: 0.35rem 0.75rem;
+  border-radius: 20px;
+  font-weight: 700;
+  font-size: 0.9rem;
+  color: white;
+  user-select: none;
+  cursor: pointer;
+  transition: background-color 0.3s ease;
+}
+.badge-warning {
+  background-color: #f39c12;
+}
+.badge-warning:hover,
+.badge-warning:focus {
+  background-color: #d78e0b;
+  outline: none;
+}
+.badge-danger {
+  background-color: #c0392b;
+}
+.badge-danger:hover,
+.badge-danger:focus {
+  background-color: #922b23;
+  outline: none;
+}
+
+/* Responsive */
+@media (max-width: 720px) {
+  .container {
+    padding: 1rem 1.2rem;
+    max-width: 100%;
+  }
+}
+@media (max-width: 480px) {
+  h1 {
+    font-size: 2rem;
+  }
+  form {
+    padding: 1rem 1.2rem;
+    max-width: 100%;
+  }
+  button, .btn-primary {
+    font-size: 1rem;
+  }
+  li {
+    font-size: 1rem;
+  }
+  .badge {
+    font-size: 0.8rem;
+    padding: 0.3rem 0.6rem;
+  }
+}
+
+/* Additional spacing */
+.mt-2 {
+  margin-top: 0.5rem;
+}
+
+br {
+  margin-bottom: 1rem;
+  display: block;
+}
+
+/* Override "Novo Usuário" button styling for better contrast */
+a.btn.btn-primary {
+  background-color: #2980b9; /* a fresh green for good contrast */
+  color: white;
+  padding: 0.6rem 1rem;
+  border-radius: 6px;
+  font-weight: 700;
+  text-transform: uppercase;
+  letter-spacing: 0.04em;
+  transition: background-color 0.3s ease, color 0.3s ease;
+  display: inline-block;
+  text-align: center;
+}
+
+a.btn.btn-primary:hover,
+a.btn.btn-primary:focus {
+  background-color: #1f6391; /* darker green on hover */
+  color: white;
+  outline: none;
 }
\ No newline at end of file
diff --git a/app/templates/book.html b/app/templates/books/book.html
similarity index 100%
rename from app/templates/book.html
rename to app/templates/books/book.html
diff --git a/app/templates/create.html b/app/templates/books/create.html
similarity index 100%
rename from app/templates/create.html
rename to app/templates/books/create.html
diff --git a/app/templates/edit.html b/app/templates/books/edit.html
similarity index 100%
rename from app/templates/edit.html
rename to app/templates/books/edit.html
diff --git a/app/templates/index.html b/app/templates/books/index.html
similarity index 100%
rename from app/templates/index.html
rename to app/templates/books/index.html
diff --git a/app/templates/users/create.html b/app/templates/users/create.html
new file mode 100644
index 0000000..55715e0
--- /dev/null
+++ b/app/templates/users/create.html
@@ -0,0 +1,29 @@
+{% extends 'base.html' %}
+
+{% block title %}Criar Usuário{% endblock %}
+
+{% block content %}
+
+<h1>Cadastrar Usuário</h1>
+
+<form method="POST">
+
+    <div class="form-group">
+        <label for="name">Nome</label>
+        <input
+            type="text"
+            class="form-control"
+            id="name"
+            name="name"
+            placeholder="Nome do usuário"
+            required
+        >
+    </div>
+
+    <button type="submit" class="btn btn-primary mt-2">Cadastrar</button>
+</form>
+
+<br>
+<a href="{{ url_for('users.home') }}">← Voltar</a>
+
+{% endblock %}
diff --git a/app/templates/users/edit.html b/app/templates/users/edit.html
new file mode 100644
index 0000000..b14634a
--- /dev/null
+++ b/app/templates/users/edit.html
@@ -0,0 +1,29 @@
+{% extends 'base.html' %}
+
+{% block title %}Editar Usuário{% endblock %}
+
+{% block content %}
+
+<h1>Editar Usuário</h1>
+
+<form method="POST">
+
+    <div class="form-group">
+        <label for="name">Nome</label>
+        <input
+            type="text"
+            class="form-control"
+            id="name"
+            name="name"
+            value="{{ request.form.get('name', user.name) }}"
+            required
+        >
+    </div>
+
+    <button type="submit" class="btn btn-primary mt-2">Salvar alterações</button>
+</form>
+
+<br>
+<a href="{{ url_for('users.home') }}">← Voltar</a>
+
+{% endblock %}
diff --git a/app/templates/users/index.html b/app/templates/users/index.html
new file mode 100644
index 0000000..907d524
--- /dev/null
+++ b/app/templates/users/index.html
@@ -0,0 +1,42 @@
+{% extends 'base.html' %}
+
+{% block title %}Usuários{% endblock %}
+
+{% block content %}
+
+<h1>Usuários</h1>
+
+<a href="{{ url_for('users.create') }}" class="btn btn-primary">+ Novo Usuário</a>
+
+<hr>
+
+{% if users %}
+    <ul>
+        {% for user in users %}
+            <li>
+                <a href="{{ url_for('users.user', user_id=user.id) }}">
+                    <strong>{{ user.name }}</strong>
+                </a>
+
+                — 
+                <a href="{{ url_for('users.edit', user_id=user.id) }}" class="badge badge-warning">
+                    Editar
+                </a>
+
+                <form action="{{ url_for('users.delete', user_id=user.id) }}"
+                      method="POST"
+                      style="display:inline;">
+                    <button class="badge badge-danger"
+                            onclick="return confirm('Tem certeza que deseja excluir este usuário?')">
+                        Deletar
+                    </button>
+                </form>
+            </li>
+            <hr>
+        {% endfor %}
+    </ul>
+{% else %}
+    <p>Nenhum usuário cadastrado.</p>
+{% endif %}
+
+{% endblock %}
diff --git a/app/templates/users/user.html b/app/templates/users/user.html
new file mode 100644
index 0000000..72b9db1
--- /dev/null
+++ b/app/templates/users/user.html
@@ -0,0 +1,36 @@
+{% extends 'base.html' %}
+
+{% block title %}Usuário {{ user['name'] }}{% endblock %}
+
+{% block content %}
+<h1>Usuário: {{ user['name'] }}</h1>
+
+<h2>Livros emprestados</h2>
+
+{% if borrowed_books %}
+  <ul>
+    {% for book in borrowed_books %}
+      <li>
+        <strong>{{ book['title'] }}</strong> — {{ book['author'] }}
+        <form action="{{ url_for('users.return_book_route', user_id=user['id'], book_id=book['id']) }}"
+              method="post"
+              style="display:inline;">
+          <button type="submit">Devolver</button>
+        </form>
+      </li>
+    {% endfor %}
+  </ul>
+{% else %}
+  <p>Nenhum livro emprestado.</p>
+{% endif %}
+
+<h2>Pegar livro emprestado</h2>
+<form method="post" action="{{ url_for('users.loan_book', user_id=user['id']) }}">
+  <label for="book_id">ID do livro:</label>
+  <input type="number" id="book_id" name="book_id" min="1" required>
+  <button type="submit">Emprestar</button>
+</form>
+
+<br>
+<a href="{{ url_for('users.home') }}">← Voltar para lista de usuários</a>
+{% endblock %}
diff --git a/infra/db/database.db b/infra/db/database.db
index ec2dbe26d051db7f12ced99ee7a8a01808415411..1a2c8041941445dbabdeef9d994c4bc78410d28e 100644
GIT binary patch
delta 110
zcmZozz}T>Wae}m<2m=EHD-go~|3n>QRuKlhyqz0U*mxOPHfQtxU}R*PoWj3oGn>Ib
z{>3Z`0z3=?3=I5F!TOjs3mRPImzHE?W8ma8W-u}^GSxLS)HO0uFf_FSA`^>64gvt6
CT@_{k

delta 138
zcmZozz}T>Wae}lU4+8@OD-go~=R_T2RvreutP2}c*mxP4HfQtxU}R*OoWj3|>nQ{O
zQ?O#z&4L0u_$}m^SQ%8+IXx1KiYgTX@=Homi@fv{y!8}<^2>818QB;(IgJ^N42(>5
g4GndTOcV?Ztqe@8OiVT@um~(>5fIqS;_!zb0KX(1@c;k-

diff --git a/infra/repositories/loan_repository_sqlite.py b/infra/repositories/loan_repository_sqlite.py
new file mode 100644
index 0000000..0f7c4a5
--- /dev/null
+++ b/infra/repositories/loan_repository_sqlite.py
@@ -0,0 +1,84 @@
+from typing import List, Mapping, Any
+from repositories.loan_repository import LoanRepository
+from infra.db.database import get_db_connection
+
+
+class LoanRepositorySQLite(LoanRepository):
+    def list_books_for_user(self, user_id: int) -> List[Mapping[str, Any]]:
+        conn = get_db_connection()
+        rows = conn.execute(
+            """
+            SELECT b.id, b.title, b.author, b.available
+            FROM loans l
+            JOIN books b ON b.id = l.book_id
+            WHERE l.user_id = ?
+            """,
+            (user_id,),
+        ).fetchall()
+        conn.close()
+        return rows
+
+    def has_active_loan(self, user_id: int, book_id: int) -> bool:
+        conn = get_db_connection()
+        row = conn.execute(
+            "SELECT 1 FROM loans WHERE user_id = ? AND book_id = ?",
+            (user_id, book_id),
+        ).fetchone()
+        conn.close()
+        return row is not None
+
+    def borrow_book(self, user_id: int, book_id: int) -> None:
+        conn = get_db_connection()
+        cur = conn.cursor()
+
+        # Verifica se o livro existe e está disponível
+        book_row = cur.execute(
+            "SELECT available FROM books WHERE id = ?", (book_id,)
+        ).fetchone()
+
+        if book_row is None:
+            conn.close()
+            raise ValueError("Livro não encontrado")
+
+        if not bool(book_row["available"]):
+            conn.close()
+            raise ValueError("Livro já está emprestado")
+
+        # Verifica se o usuário já tem esse livro emprestado
+        existing = cur.execute(
+            "SELECT 1 FROM loans WHERE user_id = ? AND book_id = ?",
+            (user_id, book_id),
+        ).fetchone()
+        if existing is not None:
+            conn.close()
+            raise ValueError("Esse usuário já possui esse livro emprestado")
+
+        # Cria empréstimo e marca como indisponível
+        cur.execute(
+            "INSERT INTO loans (book_id, user_id) VALUES (?, ?)",
+            (book_id, user_id),
+        )
+        cur.execute(
+            "UPDATE books SET available = 0 WHERE id = ?",
+            (book_id,),
+        )
+
+        conn.commit()
+        conn.close()
+
+    def return_book(self, user_id: int, book_id: int) -> None:
+        conn = get_db_connection()
+        cur = conn.cursor()
+
+        # Remove empréstimo (se existir) e marca como disponível
+        cur.execute(
+            "DELETE FROM loans WHERE user_id = ? AND book_id = ?",
+            (user_id, book_id),
+        )
+        cur.execute(
+            "UPDATE books SET available = 1 WHERE id = ?",
+            (book_id,),
+        )
+
+        conn.commit()
+        conn.close()
diff --git a/repositories/loan_repository.py b/repositories/loan_repository.py
new file mode 100644
index 0000000..5ca2e90
--- /dev/null
+++ b/repositories/loan_repository.py
@@ -0,0 +1,24 @@
+from abc import ABC, abstractmethod
+from typing import List, Mapping, Any
+
+
+class LoanRepository(ABC):
+    @abstractmethod
+    def list_books_for_user(self, user_id: int) -> List[Mapping[str, Any]]:
+        """Retorna os livros atualmente emprestados para um usuário."""
+        pass
+
+    @abstractmethod
+    def has_active_loan(self, user_id: int, book_id: int) -> bool:
+        """Verifica se esse usuário já tem esse livro emprestado."""
+        pass
+
+    @abstractmethod
+    def borrow_book(self, user_id: int, book_id: int) -> None:
+        """Cria o empréstimo e marca o livro como indisponível."""
+        pass
+
+    @abstractmethod
+    def return_book(self, user_id: int, book_id: int) -> None:
+        """Remove o empréstimo e marca o livro como disponível."""
+        pass
diff --git a/schema.sql b/schema.sql
index 8ebfd2b..41b8795 100644
--- a/schema.sql
+++ b/schema.sql
@@ -23,3 +23,11 @@ CREATE TABLE IF NOT EXISTS loans (
     FOREIGN KEY(book_id) REFERENCES books(id),
     FOREIGN KEY(user_id) REFERENCES users(id)
 );
+
+CREATE TABLE IF NOT EXISTS loans (
+    id      INTEGER PRIMARY KEY AUTOINCREMENT,
+    book_id INTEGER NOT NULL,
+    user_id INTEGER NOT NULL,
+    FOREIGN KEY (book_id) REFERENCES books (id),
+    FOREIGN KEY (user_id) REFERENCES users (id)
+);
diff --git a/use_cases/borrow_book.py b/use_cases/borrow_book.py
new file mode 100644
index 0000000..afdfaea
--- /dev/null
+++ b/use_cases/borrow_book.py
@@ -0,0 +1,10 @@
+from repositories.user_repository import UserRepository
+from repositories.loan_repository import LoanRepository
+
+
+def borrow_book(user_repo: UserRepository, loan_repo: LoanRepository, user_id: int, book_id: int) -> None:
+    user = user_repo.get_by_id(user_id)
+    if user is None:
+        raise ValueError("Usuário não encontrado")
+
+    loan_repo.borrow_book(user_id, book_id)
diff --git a/use_cases/list_user_loans.py b/use_cases/list_user_loans.py
new file mode 100644
index 0000000..c6c75f8
--- /dev/null
+++ b/use_cases/list_user_loans.py
@@ -0,0 +1,6 @@
+from typing import List, Mapping, Any
+from repositories.loan_repository import LoanRepository
+
+
+def list_books_for_user(loan_repo: LoanRepository, user_id: int) -> List[Mapping[str, Any]]:
+    return loan_repo.list_books_for_user(user_id)
diff --git a/use_cases/return_book.py b/use_cases/return_book.py
new file mode 100644
index 0000000..a049c8d
--- /dev/null
+++ b/use_cases/return_book.py
@@ -0,0 +1,10 @@
+from repositories.user_repository import UserRepository
+from repositories.loan_repository import LoanRepository
+
+
+def return_book(user_repo: UserRepository, loan_repo: LoanRepository, user_id: int, book_id: int) -> None:
+    user = user_repo.get_by_id(user_id)
+    if user is None:
+        raise ValueError("Usuário não encontrado")
+
+    loan_repo.return_book(user_id, book_id)
-- 
2.43.7

