{% extends 'base.html' %}

{% block title %}Editar Livro{% endblock %}

{% block content %}

<h1>Editar Livro #{{ book['id'] }}</h1>

<form method="post">

    <div class="form-group">
        <label for="title">Título</label>
        <input 
            type="text"
            name="title"
            class="form-control"
            value="{{ request.form.get('title', book['title']) }}"
            required
        >
    </div>

    <div class="form-group">
        <label for="author">Autor</label>
        <input 
            type="text"
            name="author"
            class="form-control"
            value="{{ request.form.get('author', book['author']) }}"
            required
        >
    </div>

    <!-- SE ESTÁ EMPRESTADO, NÃO PERMITE ALTERAR DISPONIBILIDADE -->
    {% if book.is_loaned %}
        
        <p><strong>Disponibilidade:</strong>
            <span class="badge badge-warning">Emprestado</span>
        </p>

        <input type="hidden" name="available" value="0">

    {% else %}

        <div class="form-group">
            <label for="available">Disponibilidade</label>
            <select name="available" id="available" class="form-control">
                <option value="1"
                    {% if book['available'] %}selected{% endif %}>
                    Disponível
                </option>

                <option value="0"
                    {% if not book['available'] %}selected{% endif %}>
                    Indisponível
                </option>
            </select>
        </div>

    {% endif %}

    <button type="submit" class="btn btn-primary mt-3">
        Salvar Alterações
    </button>

</form>

<hr>

<!-- Botão de deletar livro só aparece se não estiver emprestado -->
{% if not book.is_loaned %}
<form action="{{ url_for('books.delete', book_id=book['id']) }}" method="POST">
    <button class="btn btn-danger btn-sm"
            onclick="return confirm('Tem certeza que deseja deletar este livro?')">
        Deletar Livro
    </button>
</form>
{% else %}
<p class="text-muted">Não é possível excluir um livro enquanto está emprestado.</p>
{% endif %}

<br>
<a href="{{ url_for('home') }}">← Voltar</a>

{% endblock %}
