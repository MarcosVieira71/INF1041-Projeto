From a8e0e932f143a36b181d8ab680b0b07f7343800f Mon Sep 17 00:00:00 2001
From: Breno de Andrade Soares <brenoandrade@tecgraf.puc-rio.br>
Date: Tue, 25 Nov 2025 13:30:58 -0300
Subject: [PATCH 09/18] =?UTF-8?q?Adicionando=20p=C3=A1gina=20inicial?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 app/main.py                     |  45 ++++++++----
 app/routes/book_routes.py       |  12 ++--
 app/routes/user_routes.py       |  37 +++++++---
 app/static/css/style.css        |   9 +++
 app/templates/base.html         |  13 +---
 app/templates/books/edit.html   |   1 +
 app/templates/books/index.html  | 119 --------------------------------
 app/templates/index.html        |  73 ++++++++++++++++++++
 app/templates/users/create.html |   2 +-
 app/templates/users/edit.html   |   2 +-
 app/templates/users/index.html  |  42 -----------
 infra/db/database.db            | Bin 20480 -> 20480 bytes
 12 files changed, 150 insertions(+), 205 deletions(-)
 delete mode 100644 app/templates/books/index.html
 create mode 100644 app/templates/index.html
 delete mode 100644 app/templates/users/index.html

diff --git a/app/main.py b/app/main.py
index 9145cdb..f0f7fc6 100644
--- a/app/main.py
+++ b/app/main.py
@@ -1,23 +1,42 @@
-from flask import Flask, redirect, url_for
+from flask import Flask, render_template, redirect, url_for
 from app.routes.book_routes import book_bp
 from app.routes.user_routes import user_bp
+from infra.repositories.book_repository_sqlite import BookRepositorySQLite
+from infra.repositories.user_repository_sqlite import UserRepositorySQLite
+from infra.repositories.loan_repository_sqlite import LoanRepositorySQLite
+from use_cases.list_books import list_books
+from use_cases.list_users import list_users
+from use_cases.list_user_loans import list_books_for_user
 
-def create_app():
-    app = Flask(__name__, template_folder="templates", static_folder="static")
-    app.config["SECRET_KEY"] = "grXBaIz0Ag0a7XllLUI3maScR7mbnFZC"
+app = Flask(__name__, template_folder="templates", static_folder="static")
+app.config["SECRET_KEY"] = "grXBaIz0Ag0a7XllLUI3maScR7mbnFZC"
 
-    app.register_blueprint(book_bp)
-    app.register_blueprint(user_bp)
+# Instanciando os repositórios
+book_repo = BookRepositorySQLite()
+user_repo = UserRepositorySQLite()
+loan_repo = LoanRepositorySQLite()
 
-    # Rota principal (home) que redireciona para a página de livros
-    @app.route('/')
-    def home():
-        return redirect(url_for('books.home'))  # Redireciona para a página de livros
-
-    return app
+@app.route('/', methods=["GET"])
+def home():
+    books = list_books(book_repo)
+    users = list_users(user_repo)
+    
+    loans = []
+    for user in users:
+        borrowed_books = list_books_for_user(loan_repo, user.id)
+        for book in borrowed_books:
+            loans.append({
+                'book_id': book['id'],
+                'title': book['title'],
+                'author': book['author'],
+                'user_name': user.name,
+                'user_id': user.id,
+            })
 
+    return render_template('index.html', books=books, users=users, loans=loans)
 
+app.register_blueprint(book_bp)
+app.register_blueprint(user_bp)
 
 if __name__ == "__main__":
-    app = create_app()
     app.run(debug=True)
diff --git a/app/routes/book_routes.py b/app/routes/book_routes.py
index 3ee7294..b45e168 100644
--- a/app/routes/book_routes.py
+++ b/app/routes/book_routes.py
@@ -15,7 +15,7 @@ book_bp = Blueprint("books", __name__, url_prefix="/books")
 @book_bp.route("/", methods=["GET"])
 def home():
     books = list_books(book_repo)
-    return render_template("books/index.html", books=books)
+    return render_template("index.html", books=books)
 
 # ======================== Exibir livro ==========================
 @book_bp.route("/<int:book_id>", methods=["GET"])
@@ -23,7 +23,7 @@ def book(book_id):
     book = get_book(book_repo, book_id)
     if book is None:
         flash("Livro não encontrado")
-        return redirect(url_for("books.home"))
+        return redirect(url_for("home"))
     return render_template("books/book.html", book=book)
 
 # ======================== Criar livro ==========================
@@ -39,7 +39,7 @@ def create():
         else:
             create_book(book_repo, title, author, available)
             flash("Livro cadastrado com sucesso!")
-            return redirect(url_for("books.home"))
+            return redirect(url_for("home"))
 
     return render_template("books/create.html")
 
@@ -49,7 +49,7 @@ def edit(book_id):
     book = get_book(book_repo, book_id)
     if book is None:
         flash("Livro não encontrado")
-        return redirect(url_for("books.home"))
+        return redirect(url_for("home"))
 
     if request.method == "POST":
         title = request.form["title"]
@@ -61,7 +61,7 @@ def edit(book_id):
         else:
             update_book(book_repo, book_id, title, author, available)
             flash("Livro atualizado com sucesso!")
-            return redirect(url_for("books.home"))
+            return redirect(url_for("home"))
 
     return render_template("books/edit.html", book=book)
 
@@ -70,4 +70,4 @@ def edit(book_id):
 def delete(book_id):
     delete_book(book_repo, book_id)
     flash("Livro deletado com sucesso!")
-    return redirect(url_for("books.home"))
+    return redirect(url_for("home"))
diff --git a/app/routes/user_routes.py b/app/routes/user_routes.py
index 355a946..68f727b 100644
--- a/app/routes/user_routes.py
+++ b/app/routes/user_routes.py
@@ -22,7 +22,22 @@ user_bp = Blueprint("users", __name__, url_prefix="/users")
 @user_bp.route("/", methods=["GET"])
 def home():
     users = list_users(user_repo)
-    return render_template("users/index.html", users=users)
+    loans = []
+    
+    # Listando empréstimos de livros
+    for user in users:
+        borrowed_books = list_books_for_user(loan_repo, user.id)
+        for book in borrowed_books:
+            loans.append({
+                'book_id': book['id'],
+                'title': book['title'],
+                'author': book['author'],
+                'user_name': user.name,
+                'user_id': user.id,
+            })
+
+    return render_template("index.html", users=users, loans=loans)
+
 
 
 # ====== Detalhe do usuário + livros emprestados ======
@@ -31,7 +46,7 @@ def user(user_id):
     u = get_user(user_repo, user_id)
     if u is None:
         flash("Usuário não encontrado")
-        return redirect(url_for("users.home"))
+        return redirect(url_for("home"))
 
     borrowed_books = list_books_for_user(loan_repo, user_id)
     return render_template("users/user.html", user=u, borrowed_books=borrowed_books)
@@ -48,7 +63,7 @@ def create():
         else:
             create_user(user_repo, name)
             flash("Usuário cadastrado com sucesso!")
-            return redirect(url_for("users.home"))
+            return redirect(url_for("home"))
 
     return render_template("users/create.html")
 
@@ -56,10 +71,10 @@ def create():
 # ====== Editar usuário ======
 @user_bp.route("/<int:user_id>/edit", methods=["GET", "POST"])
 def edit(user_id):
-    u = get_user(user_repo, user_id)
-    if u is None:
+    user = get_user(user_repo, user_id)
+    if user is None:
         flash("Usuário não encontrado")
-        return redirect(url_for("users.home"))
+        return redirect(url_for("home"))
 
     if request.method == "POST":
         name = request.form["name"]
@@ -69,9 +84,9 @@ def edit(user_id):
         else:
             update_user(user_repo, user_id, name)
             flash("Usuário atualizado com sucesso!")
-            return redirect(url_for("users.home"))
+            return redirect(url_for("home"))
 
-    return render_template("users/edit.html", user=u)
+    return render_template("users/edit.html", user=user)
 
 
 # ====== Deletar usuário ======
@@ -79,7 +94,7 @@ def edit(user_id):
 def delete(user_id):
     delete_user(user_repo, user_id)
     flash("Usuário deletado com sucesso!")
-    return redirect(url_for("users.home"))
+    return redirect(url_for("home"))
 
 
 # ====== Emprestar livro para usuário ======
@@ -91,7 +106,7 @@ def loan_book(user_id):
         flash("Livro emprestado com sucesso!")
     except ValueError as e:
         flash(str(e))
-    return redirect(url_for("users.user", user_id=user_id))
+    return redirect(url_for("home", user_id=user_id))
 
 
 # ====== Devolver livro ======
@@ -102,4 +117,4 @@ def return_book_route(user_id, book_id):
         flash("Livro devolvido com sucesso!")
     except ValueError as e:
         flash(str(e))
-    return redirect(url_for("users.user", user_id=user_id))
+    return redirect(url_for("home", user_id=user_id))
diff --git a/app/static/css/style.css b/app/static/css/style.css
index 175b702..367e978 100644
--- a/app/static/css/style.css
+++ b/app/static/css/style.css
@@ -765,4 +765,13 @@ a.btn.btn-primary:focus {
   background-color: #1f6391; /* darker green on hover */
   color: white;
   outline: none;
+}
+
+ul { 
+  list-style: none; 
+  padding: 0; margin: 0; 
+  margin: 0; 
+}
+li { display: inline-block; 
+  margin-right: 16px; 
 }
\ No newline at end of file
diff --git a/app/templates/base.html b/app/templates/base.html
index 727dd9c..73e6ffe 100644
--- a/app/templates/base.html
+++ b/app/templates/base.html
@@ -10,20 +10,9 @@
 </head>
 <body>
     <header>
-        <h1>Biblioteca</h1>
+        <h1>Clean Library</h1>
         <hr>
     </header>
-    <div class="collapse navbar-collapse" id="navbarNav">
-        <ul class="navbar-nav">
-        <li class="nav-item">
-            <a class="nav-link" href="#">About</a>
-        </li>
-        <li class="nav-item">
-            <a class="nav-link" href="{{url_for('books.create')}}">Novo livro</a>
-        </li>
-
-        </ul>
-    </div>
     <div class="container">
         {% for message in get_flashed_messages() %}
             <div class="alert alert-danger">{{ message }}</div>
diff --git a/app/templates/books/edit.html b/app/templates/books/edit.html
index d91eaeb..606d3ee 100644
--- a/app/templates/books/edit.html
+++ b/app/templates/books/edit.html
@@ -33,5 +33,6 @@
             class="btn btn-danger btn-sm"
             onclick="return confirm('Tem certeza que você deseja deletar esse livro?')">
 </form>
+<a href="{{ url_for('home') }}">← Voltar</a>
 
 {% endblock %}
diff --git a/app/templates/books/index.html b/app/templates/books/index.html
deleted file mode 100644
index f3b7472..0000000
--- a/app/templates/books/index.html
+++ /dev/null
@@ -1,119 +0,0 @@
-{% extends 'base.html' %}
-
-{% block title %}
-Acervo de Livros
-{% endblock %}
-
-{% block content %}
-
-<nav>
-  <a href="#livros">Livros</a>
-  <a href="#usuarios">Usuários</a>
-  <a href="#emprestimos">Empréstimos</a>
-  <a href="#devolucoes">Devoluções</a>
-</nav>
-<hr>
-
-<!-- ======================= LIVROS ======================= -->
-<section id="livros" class="bloco">
-  
-  <h2>Livros</h2>
-
-  {% for book in books %}
-        <div>
-            <h3>{{ book['title'] }}</h3>
-            <p><strong>Autor:</strong> {{ book['author'] }}</p>
-
-            {% if book['available'] %}
-                <span style="color: green;">Disponível</span>
-            {% else %}
-                <span style="color: red;">Emprestado</span>
-            {% endif %}
-
-            <a href="{{ url_for('books.edit', book_id=book['id']) }}">
-              <span class="badge badge-warning">Edit</span>
-            </a>
-
-            <hr>
-        </div>
-    {% else %}
-        <p>Nenhum livro cadastrado.</p>
-    {% endfor %}
-
-  <h3>Listar / Pesquisar</h3>
-  <form method="get" action="/books" class="form">
-    <label for="query">Busca por título/autor (opcional):</label>
-    <input type="text" id="query" name="query" placeholder="Ex.: Clean Code">
-    <button type="submit">Listar</button>
-  </form>
-
-  <h3>Cadastrar Livro</h3>
-  <form method="post" action="/books" class="form">
-    <label for="title">Título:</label>
-    <input type="text" id="title" name="title" required>
-
-    <label for="author">Autor:</label>
-    <input type="text" id="author" name="author" required>
-
-    <button type="submit">Cadastrar</button>
-  </form>
-
-</section>
-
-<hr>
-
-<!-- ======================= USUÁRIOS ======================= -->
-<section id="usuarios" class="bloco">
-
-  <h2>Usuários</h2>
-
-  <h3>Cadastrar Usuário</h3>
-  <form method="post" action="/users" class="form">
-    <label for="user_name">Nome:</label>
-    <input type="text" id="user_name" name="name" required>
-    <button type="submit">Cadastrar</button>
-  </form>
-
-</section>
-
-<hr>
-
-<!-- ======================= EMPRÉSTIMOS ======================= -->
-<section id="emprestimos" class="bloco">
-
-  <h2>Empréstimos</h2>
-
-  <h3>Emprestar Livro</h3>
-  <form method="post" action="/loans" class="form">
-    <label for="loan_book_id">ID do Livro:</label>
-    <input type="number" id="loan_book_id" name="book_id" min="1" required>
-
-    <label for="loan_user_id">ID do Usuário:</label>
-    <input type="number" id="loan_user_id" name="user_id" min="1" required>
-
-    <button type="submit">Emprestar</button>
-  </form>
-
-</section>
-
-<hr>
-
-<!-- ======================= DEVOLUÇÕES ======================= -->
-<section id="devolucoes" class="bloco">
-
-  <h2>Devoluções</h2>
-
-  <h3>Devolver Livro</h3>
-  <form method="post" action="/returns" class="form">
-    <label for="return_book_id">ID do Livro:</label>
-    <input type="number" id="return_book_id" name="book_id" min="1" required>
-    <button type="submit">Devolver</button>
-  </form>
-
-</section>
-
-<hr>
-
-<p>© Biblioteca — Exemplo educacional (Flask + Clean Architecture)</p>
-
-{% endblock %}
diff --git a/app/templates/index.html b/app/templates/index.html
new file mode 100644
index 0000000..e4ef657
--- /dev/null
+++ b/app/templates/index.html
@@ -0,0 +1,73 @@
+{% extends 'base.html' %}
+
+{% block title %}Página Principal - Biblioteca{% endblock %}
+
+{% block content %}
+
+<!-- Botões principais -->
+<h1>Bem-vindo à Biblioteca</h1>
+
+<div class="btn-group" role="group">
+    <a href="{{ url_for('books.create') }}" class="btn btn-success">Novo Livro</a>
+    <a href="{{ url_for('users.create') }}" class="btn btn-primary">Novo Usuário</a>
+    <a href="{{ url_for('users.home') }}" class="btn btn-info">Emprestar Livro</a>
+</div>
+
+<hr>
+
+<!-- Listar Livros -->
+<h2>Livros</h2>
+{% if books %}
+    <ul>
+        {% for book in books %}
+            <li>
+                <a href="{{ url_for('books.edit', book_id=book['id']) }}">
+                    <strong>{{ book['title'] }}</strong>
+                </a> — {{ book['author'] }}
+                <span class="badge {% if book['available'] %}badge-success{% else %}badge-danger{% endif %}">
+                    {% if book['available'] %}Disponível{% else %}Emprestado{% endif %}
+                </span>
+            </li>
+        {% endfor %}
+    </ul>
+{% else %}
+    <p>Nenhum livro cadastrado.</p>
+{% endif %}
+
+<hr>
+
+<!-- Listar Usuários -->
+<h2>Usuários</h2>
+{% if users %}
+    <ul>
+        {% for user in users %}
+            <li>
+                <a href="{{ url_for('users.edit', user_id=user.id) }}">
+                    <strong>{{ user['name'] }}</strong>
+                </a>
+                <a href="{{ url_for('users.user', user_id=user.id) }}" class="btn btn-info btn-sm">Ver empréstimos</a>
+            </li>
+        {% endfor %}
+    </ul>
+{% else %}
+    <p>Nenhum usuário cadastrado.</p>
+{% endif %}
+
+<hr>
+
+<!-- Livros Emprestados -->
+<h2>Livros Emprestados</h2>
+{% if loans %}
+    <ul>
+        {% for loan in loans %}
+            <li>
+                <strong>{{ loan['title'] }}</strong> — {{ loan['author'] }} (Emprestado por: {{ loan['user_name'] }})
+                <a href="{{ url_for('users.return_book_route', user_id=loan['user_id'], book_id=loan['book_id']) }}" class="btn btn-danger btn-sm">Devolver</a>
+            </li>
+        {% endfor %}
+    </ul>
+{% else %}
+    <p>Não há livros emprestados no momento.</p>
+{% endif %}
+
+{% endblock %}
diff --git a/app/templates/users/create.html b/app/templates/users/create.html
index 55715e0..53fa6c4 100644
--- a/app/templates/users/create.html
+++ b/app/templates/users/create.html
@@ -24,6 +24,6 @@
 </form>
 
 <br>
-<a href="{{ url_for('users.home') }}">← Voltar</a>
+<a href="{{ url_for('home') }}">← Voltar</a>
 
 {% endblock %}
diff --git a/app/templates/users/edit.html b/app/templates/users/edit.html
index b14634a..086d942 100644
--- a/app/templates/users/edit.html
+++ b/app/templates/users/edit.html
@@ -24,6 +24,6 @@
 </form>
 
 <br>
-<a href="{{ url_for('users.home') }}">← Voltar</a>
+<a href="{{ url_for('home') }}">← Voltar</a>
 
 {% endblock %}
diff --git a/app/templates/users/index.html b/app/templates/users/index.html
deleted file mode 100644
index 907d524..0000000
--- a/app/templates/users/index.html
+++ /dev/null
@@ -1,42 +0,0 @@
-{% extends 'base.html' %}
-
-{% block title %}Usuários{% endblock %}
-
-{% block content %}
-
-<h1>Usuários</h1>
-
-<a href="{{ url_for('users.create') }}" class="btn btn-primary">+ Novo Usuário</a>
-
-<hr>
-
-{% if users %}
-    <ul>
-        {% for user in users %}
-            <li>
-                <a href="{{ url_for('users.user', user_id=user.id) }}">
-                    <strong>{{ user.name }}</strong>
-                </a>
-
-                — 
-                <a href="{{ url_for('users.edit', user_id=user.id) }}" class="badge badge-warning">
-                    Editar
-                </a>
-
-                <form action="{{ url_for('users.delete', user_id=user.id) }}"
-                      method="POST"
-                      style="display:inline;">
-                    <button class="badge badge-danger"
-                            onclick="return confirm('Tem certeza que deseja excluir este usuário?')">
-                        Deletar
-                    </button>
-                </form>
-            </li>
-            <hr>
-        {% endfor %}
-    </ul>
-{% else %}
-    <p>Nenhum usuário cadastrado.</p>
-{% endif %}
-
-{% endblock %}
diff --git a/infra/db/database.db b/infra/db/database.db
index 1a2c8041941445dbabdeef9d994c4bc78410d28e..369835b5f6bb74260daed65a90a4e86dc1c1e67e 100644
GIT binary patch
delta 146
zcmZozz}T>Wae}m<Dgy%pD-gqg=tLc3M%9f8T)d1-o3nX;Ffy`CPT^m~^^}4CDOe%P
zW<i17{HD@OtPJ|%oB^qYr2;Ih4C0cUA*sbBsX#)Kk&S_q)0n}?z{phB&`{UNRKd{9
n%E;2n)NGT&4Sp^rW^u;S;?$yImdTIwl@_xI2yA9?_`?qXIQk!D

delta 122
zcmZozz}T>Wae}m<2m=EHD-go~|3n>QMv;vPT)d1do3nX;FfuYtPT^m)na$uI|7I42
zEBsuH%;Jnm`T5z!Op_n!EAcQ0Ffi~x1)IUNS<v7rzqBMH8v`e&F@uqTk*Thsp{|jM
Pf}yDu5Sdskau5Ij0QeaE

-- 
2.43.7

